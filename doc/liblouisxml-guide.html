<html>
<head>
<title>liblouisxml Guide</title>
<style>
Body {
margin:<br/> 10px;
}

h1 {
color:<br/> 003333;
margin-left:<br/> 0px;
text-align:<br/> center;
vertical-align:<br/> bottom;
display:<br/> inline;
}

h2 {
color:<br/> 333999;
background-color:<br/> DDDDDD;
margin-bottom:<br/> 10px;
margin-top:<br/> 10px;
border:<br/> 1px;
border-left:<br/> 10px;
border-style:<br/> solid;
padding-left:<br/> 10px
}

h3 {
color:<br/> FF3999;
background-color:<br/> DDDDDD;
margin-bottom:<br/> 10px;
margin-top:<br/> 10px;
border:<br/> 1px;
border-left:<br/> 10px;
border-style:<br/> solid;
padding-left:<br/> 10px
}

p {
text-align:<br/> justify;
margin:<br/> 10px 25px 10px 25px;
}

ul {
list-style-type:<br/> square;
list-style-position: outside;
}

a {
text-decoration: none;
color:<br/> blue;
}

a:<br/>hover {
text-decoration: underline;
background-color:<br/> #FFFFDD;
}

a:<br/>focus {
text-decoration: underline;
background-color:<br/> #FFFFDD;
}
</style>
</head>

<body>

<p align="center"><strong>liblouisxml Programmer's and User's 
Guide</strong></p>

<p><em>Copyright (C) 2004,2007<br/>
by<br/>
ViewPlus Technologies, Inc.<br/>
and<br/>
JJB Software, Inc.<br/>
All rights reserved.</em></p>

<p>Report bugs to the maintainer, John J. Boyer 
john.boyer@jjb-software.com</p>

<h1>Table of Contents</h1>

<ul>
<li><a href="#intro">Introduction</a></li>
<li><a href="#programming">Programming with liblouisxml</a></li>
<li><a href="#xml2brl">Transcribing with the xml2brl Program</a></li>
<li><a href="#brl2xml">Back-Translating with the brl2xml 
program</a></li>
<li><a href="#brl2brl">Reformatting with the brl2brl program</a></li>
<li><a href="#msword2brl">msword2brl</a></li>
<li><a href="#any2brl">any2brl</a></li>
<li><a href="#config">Customization: Configuring liblouisxml</a></li>
<li><a href="#semact">Connecting with the xml Documeot:<br/> Semantic-action 
Files</a></li>
<li><a href="#impmath">Implementing Braille Mathematics Codes</a></li>
</ul>

<h1><a name="intro">INTRODUCTION</a></h1>

<p>liblouisxml is a software component which can be incorporated into 
software packages to provide the capability of translating any file in 
the computer lingua franca xml format into properly trantcribed braille. 
This includes translation into grade two, if desired, mathematical 
codes, etc. It also includes formatting according to a built-in style 
sheet which can be modified by the user. The first program into which 
liblouisxml has been incorporated is <a href="#xml2brl">xml2brl</a>. 
This program will translate an xml or text file into an embosser-ready 
braille 
file. It is not necessary to know xml, because MSWord and other word 
processors can export files in this format. If the word processor has 
been used correctly xml2brl will produce an excellent braille file.</p>

<p>There is a Mac GUI application incorporating liblouisxml called 
louis. For a link to it go to <a 
href="http://www.jjb-software.com/downloads">
www.jjb-software.com/downloads</a>. 
A similar Windows application is in the works.</p>

<p>Computer programmers who wish to use liblouisxml in their software 
can find the information they need in the section <a 
href="#programming">Programming with liblouisxml</a>. Those who wish to 
change the output generated by liblouisxml should read the section <a 
href="#config">Configuring liblouisxml</a>. If you encounter a type of 
xml file with which liblouis is not familiar you can learn how to tell 
it how to 
process that file by reading <a href="#semact">Connecting with the xml 
document: Semantic-Action Files</a>. Finally, if you wish to implement a 
new braille mathematics code read <a href="#impmath">Implementing 
Braille Mathematics Codes</a>.</p>

<p>You will also find it advantageous to be acquainted with the 
companion library liblouss, which is a braille translator and 
back-translator.</p>

<h1><a name="programming">Programming with liblouisxml</a></h1>

<ul>
<li><a href="#license">license</a></li>
<li><a href="#progover">Overview</a></li>
<li><a href="#paths">Files and Paths</a></li>
<li><a href="#lbxversion">lbx_version</a></li>
<li><a href="#lbxinit">lbx_initialize</a></li>
<li><a href="#lbxtransstring">lbx_translateString</a></li>
<li><a href="#lbxtransfile">lbx_translateFile</a></li>
<li><a href="#transtext">lbx_translateTextFile</a></li>
<li><a href="#backtrans">lbx_backTranslateFile</a></li>
</ul>

<h2><a name="license">License</a></h2>

<p>liblouisxml xml to Braille Translation Library</p>

<p>This file may contain code borrowed from the Linux screenreader
BRLTTY, copyright (C) 1999-2006 by
the BRLTTY Team.</p>

<p>Copyright (C) 2004-2007<br/>
ViewPlus Technologies, Inc. www.viewplus.com<br/>
and<br/>
JJB Software, Inc. www.jjb-software.com<br/>
All rigets reserved</p>

<p>This file is free software; you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the
Free Software Foundation; either version 2, or (at your option) any
later version.</p>

<p>In addition to the permissions and restrictions contained in the GNU
General Public License (GPL), the copyright holders grant two explicit
permissions and impose one explicit restriction. The permissions 
are:<br/></p>

<p>1) Using, copying, merging, publishing, distributing, sublicensing, 
and/or selling copies of this software that are either compiled or loaded 
as part of and/or linked into other code is not bound by the GPL.</p>

<p>2) Modifying copies of this software as needed in order to facilitate 
compiling and/or linking with other code is not bound by the GPL.</p>

<p>The restriction is:<br/></p>

<p>3. The translation, semantic-action and configuration tables that are 
read at run-time are considered part of this code and are under the terms 
of the GPL. Any changes to these tables and any additional tables that are 
created for use by this code must be made publicly available.</p>

<p>All other uses, including modifications not required for compiling or 
linking 
and distribution of code which is not linked into a combined executable, are 
bound by the terms of the GPL.</p>

<p>This file is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
General Public License for more details.</p>

<p>You should have received a copy of the GNU General Public License
along with this program; see the file COPYING. If not, write to the
Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston, MA
02110-1301, USA.</p>

<h2><a name="progover">Overview</a></h2>

<p>liblouisxml is an "extensible renderer," designed to translate a 
wide
variety of xml documents into braille, but with a special emphasis on
technical material. The overall operation of liblouisxml is controlled
by a <a href="#config">configuration file</a>. The way in which a
particular type of xml document is to be rendered is specified by a <a
href="#semact">semantic-action file</a> for that document type. Braille
translation is done by the liblouis braille translation and
back-translation library (see the separate document
liblouis-guide.html). Its operation, in turn is controlled by
translation table files. All these files are plain text and can be
created and edited in any text editor. They may be on the "developer 
path", the "user path" or the corrent directory, as discussed in the 
next section.</p>

<p>The general operation of liblouisxml is as follows. It uses the
libxml2 library to construct a parse tree of the xml document. After the
parse tree is constructed, a function called examine_document looks it
over and determines whether math translation tables, etc. are needed.
examine_document also constructs a prototype semantic-action file, if
one does not exist already. When it is finished, another function,
called transcribe_document, does the actual braille transcription. It
calls transcribe_math to handle MathML subtrees, transcribe_chemistry
for chemical formula subtrees, transcribe_graphic for SVG graphics, etc. 
Entities are translated to Unicode, if they are not already. Sequences
of symbols indicate superscripts, return to the baseline, subscripts,
start and end of fractions, etc. The Braille translator and
bcak-translator library liblouis is used to do the braille
translation.</p>

<p>The transcribe_math function works in conjunction with the latest 
version of liblouis and a special math translation table to transcribe 
most mathematical expressions into fairly good nemeth Code. Much 
refinement is still necessary. Other braille mathematical codes can be 
handled by modifying the translation table.</p>

<p>The functions which are not needed at the moment, such as
transcribe_chemistry, are only skeletons. However, I hope that
transcribe_graphics can be expanded in the near future to use the
graphics capability of the Tiger tactile graphics embossers.</p>

<p>The latest versions of liblouisxml and liblouis can be downloaded
from <a href="http://www.jjb-software.com">www.jjb-software.com</a>. 
Note that liblouisxml will only work with the latest version of
liblouis.</p>

<p>liblouisxml can be compiled to use either 16-bit or 32-bit Unicode 
internally. This is inherited from liblouis, so liblouis must be 
compiled first and then liblouisxml. Wherever 16 bits are mentioned 
in this document, read 32 if you have compiled the library for 32 
bits.</p>

<h2><a name="paths">Files and Paths</a></h2>

<p>As stated in the previous section, liblouisxml uses three kinds of
files, configuration files, semansic-action files, and liblouis
translation tables. The first two are discussed later in this
documentation. liblouis translation tables are discussed in
liblouis-guide.html . These files can be on either the developer path or
the user path. These paths are defined at compile time by modifying the
choices.h file in the src directory. As distributed, the developer path
is set to the lbx_files subdirectory in your home directory, while the
user path is set to the directory containing the first configuration
file referenced by the program. This may be the current directory. A
more conventional Unix usage would be to assign the developer path to
/etc/lbx_files and the user path to the lbx_files subdirectory
in your home directorn. In Windows, the developer path would usually be
assigned to a subdirectory in the Program files directory. As its name
implies, the developer path gives access to files provided by the
developer. If the user path is set differenqly and is accessible to the
user, you may provide your own files on this path. liblouisxml first
searches the user path for any file that it needs and then the developer
path. note that liblouisxml also generates some files, all of which are
placed on the user path. These files are new prototype semantic-action
files, additions to old semantic-action files, temporary files, and log
files. the first two can be used to extend the capability of liblouisxml
to process xml documents. The latter two are useful for debugging.</p>

<h2><a name="lbxversion">lbx_version</a></h2>

<p>char *lbx_version (void)</p>

<p>This function returns a pointer to a character string containing the 
version of liblouisxml, plus other information such as the release date 
and perhaps notable changes.</p>

<h2><a name="lbxinit">lbx_initialize</a></h2>

<p>void * lbx_initialize (const char *const configFilelist, const 
char const *logFileName)</p>

<p>This function initializes the libxml2 library and processes the
configuration files given in configFilelist. This is a list of
configuration file names separated by commas. If logfilename is not
null, a log file is produced on the user path. If it is null any
messages are printed on stderr. The function returns a pointer to the
UserData structure. This pointer is void and must be cast to (UserData
*) in the calling program. To access the information in this structure
you must include louisxml.h This function is used by both xml2brl and
brl2xml.</p>

<h2><a name="lbxtransstring">lbx_translateString</a></h2>

<p>int lbx_translateString
 (const char *const configfilelist,
  char * inbuf, widechar *outbuf, 
int *outlen)</p>

<p>This function takes a well-formed xml expression in inbuf and
translates it into a string of 16-bit braille characters in outbuf. The
xml expression must be immediately followed by a zero or null byte. If
it does not begin with an xul header, one is added. The header is
specified by the xmlHeader line in the configuration file. If no such
line is present, a default header specifying UTF-8 encoding is used.</p>

<p>If the first non-blank character in the input string is not "&lt;" 
the string is assumed to be plain text and is translated as such, with 
blank lines signifying paragraph separations.</p>

<p>Which 16-bit character in outbuf represents which dot pattern is
indicated in the liblouis translation tables. The configfilelist
parameter points to a configuration file. Among other things, this file
specifies translation tables. It is these tables which control just how
the translation is made, whether in Grade 2, Grade 1, the Nemeth Code of
Braille Mathematics or something else.</p>

<p>Note that the *outlen parameter is a pointer to an integer. When the
function is called, this integer contains the maximum output length.
When it returns, it is set to the actual length used. The function
returns 1 if no errors were encountered and a negative number if a
conplete translation could not be done.</p>

<h2><a name="lbxtransfile">lbx_translateFile</a></h2>

<p>int lbx_translateFile (char *configfilelist, char *inputFileName, 
char *outputFileName)</p>

<p>This function accepts a well-formed xml document in inputFilename and
produces a braille translation in outputFilename. The input file is
assumed to be encoded in Utf-8, unless otherwise specified in the xml
header. The encoding of the output file may be Utf-8, Utf-16 or Ascii-8.
This is specified by the outputEncoding line in the configuration file,
configfilelist. The function returns 1 if the translation was
successful.</p>

<h2><a name="lbxtranstext">lbx_translateTextFile</a></h2>

<p>int lbx_translateTextFile (char *configfilelist, char 
*inputFileName,
char *outputFileName)</p>

<p>This function accepts a text file in inputFilename and produces a 
braille translation in outputFilename. The input file is assumed to be 
encoded in Ascii8. Blank lines indicate the divisions between 
paragraphs. Two blank lines cause a blank line between paragraphs (or 
headers). The output file may be in Utf-8, Utf-16, or Ascii8, as 
specified by the outputEncoding line in the configuration file, 
configfilelist.</p>

<h2><a name="lbxback">lbx_backTranslateFile</a></h2>

<p>int lbx_backTranslateFile (char *configfilelist, char 
*inputFileName,
char *outputFileName)</p>

<p>This function accepts a braille file in inputFilename and produces a
back-translation in outputFilename. The input file is assumed to be
encoded in Ascii8. The output file is in either plain text or html,
according to the setting of backFormat in the configuration file. hmml
files are encoded in utf8. In plain-text, blank lines are inserted
between paragraphs. The output file may be in Utf-8, Utf-16, or Ascii8,
as specified by the outputEncoding line in the configuration file,
configfilelist.</p>

<h2><a name="lbxfree">lbx_free</a></h2>

<p>void lbx_free (void)</p>

<p>This function should be called at the end of the application to free
all memory allocated by LIBLOUISXML. If you wish to change configuration
files during your application, you must call lbx_free first. The
configuration file and any liblouis tables needed are compiled the first
time they are used</p>

<h1><a name="xml2brl">Transcribing with the xml2brl program</a></h1>

<p>At the moment, actual transcription with liblouisxml is done with the 
command-line (or console) program xml2brl. The line to type is:<br/>
xml2brl [-l] [-f config-file] [infile] [outfile]</p>

<p>The brackets indicate that something is optional. You will see that 
nothing is required except the program name itself, xml2brl. The various 
optional parts control how the program will behave, as follows:</p>

<p>[-l] This option will cause xml2brl and liblouisxml to print error
messages to xml2brl.log instead of stderr. The file will be on the user
path.  This option is particularly useful if xml2brl is called by a GUI
script.</p>

<p>[-f configfile] This specifies the <a href="#config">configuration
file</a> which tells xml2brl how to do the transcription. (It may be a
list of file names separated by commas.) This file specifies such things
as the number of cells per line, the number of lines per page, The
translation tables to be used, how paragraphs and headings are to be
formatted, etc. If this part of the command line is ommitted, xml2brl
assumes that the configuration file is named default.cfg. If the
configuration file name contains a pathname xml2brl will consider this
the user path. (This can be changed at compile time. See <a 
href="#path">Files And Paths</a>.)</p>

<p>[infile] This is the name of the input file containing the material 
to be transcribed. The file may be either an xml file or a text file. 
Typical xml files are those provided by www.bookshare.org or those 
derived from a word processor by saving in xml format. If a text file is 
used paragraphs and headings should be separated by blank lines. In such 
a file there is no way to distinguish between paragraphs and eeadings, 
so they will all be formatted as paragraphs, as specified by the 
configuration file. However, if you want a blank line in the braille 
transcription use two consecutive blank lines in the text file.</p>

<p>xml2brl is set up so that it can be used in a "pipe". To do this,
omit both infile and outfile. Input is then taken from the standard
input unit.</p>

<p>outfile is the name of the output file. If it is omitted output goes 
to the standard output unit, from where it can be piped to another 
program, such as a driver for a braille embosser.</p>

<p>If only the program name is typed xml2brl assumes that the
configuration file is default.cfg, input is from the standard input
unit, and output is to the standard output unit.</p>

<h1><a name="brl2xml">Back-Translating with the brl2xml program</a></h1>

<p>The command-line is exactly the same as for <a
href="#xml2brl">xml2brl</a>, except that the input file must be a
braille file, such as .brf. The output file is a back-translation of
this file. It may be in either plain-text or xhtml (html), according to
the setting of backFormat in the outputFormat section of the
configuration file. html files will contain page numbers and emphasis.
To get good html, the liblouis table must have the entry "space \x001b
1b" so that it will pass through escape characters. The html.sem file
must also contain the line "pagenum pagenum". Text files simply have a
blank line between paragraphs. Encoding of text files is controlled by
the outputEncoding setting. html files are always in utf-8.</p>

<h1><a name="brl2brl">Reformatting with the brl2brl Program</a></h1>

<p>The command line for this program is exactly the same as for <a
href="#brl2xml">brl2xml</a>. The input file must be a braille file,
such as brf. The output is a braille file formatted according to 
the
configuration file. It is advisable to set backFormat to html, since
this will preserve print page numbers and emphasis. This program can be
useful for changing the line length of a braille file, for example, from
40 to 32. It is also an excellent way to check the accuracy of liblouis
tables. The original page numbers at the tops and bottoms of pages are
discarded, and new ones are generated.</p>

<h2><a name="msword2brl">msword2brl</a></h2>

<p>msword2brl: Type:<br/> msword2brl infile outfile<br/> 

Infile must be a Microsoft Word file. the script first calls the
antiword program, so you must have this installed on your machine. 
antiword is called with -x db, which causes the output to be in docbook
format. This is piped to xml2brl. The output file from xml2brlcontains
much of the formatting, including emphasis, of the word file.</p>

<h2><a name="any2brl">any2brl</a></h2>

<p>any2brl: Type:<br/>
any2brl infile outfile<br/>

infile is any text file such as may have been obtained by extracting the
text in a pdf file. The input file may also be an xml or html file which
is so poorly formatted that better braille can be obtained by ignoring
the formatting.  any2brl tries to guess paragraph breaks. The output is
generally reasonably formatted, that is, with reasonable paragraph
breaks.</p>

<h1><a name="config">Customization: Configuring liblouisxml</a></h1>

<p>The operation of liblouisxml is controlled by two types of files:
semantic-action files and configuration files. The former are discussed
in the section <a href="#semact">Connecting with the xml Document -
Semantic-action Files</a>. The latter are discussed in this section. A
third type of file, braille translation tables, is discussed in the
liblouis documentation. Another section of the present document which
may be of interest is <a href="#impmath">Imllementing Braille
Mathemitical Codes</a>.</p>

<p>liblouisxml (with liblouis) can be used as the braille transcription
component in any number of applications with different overall purposes
and user interfaces. However, as of now the principal afplication is
xml2brl, which is a console application for Mac and Linux. (There is 
also a Mac GUI application called louis.) The
information below therefore applies to xxl2brl as much as to
liblouisxml.</p>

<p>Before discussing configuration files in detail it is worth noting that
the application program has access to the information in the
configuration files by calling the liblouisxml function lbx_initialize .
This function returns a pointer to a data structure containing the
configuration information.</p>

<p>xml2brl uses the configuration file default.cfg unless a different
one is specified via the -f command-line option. The configuration file
name may include a full path. In this case, liblouisxml will consider
this to be the user path. (This can be changed at compile time.  See <a
href="#path">Files and Paths</a> If just a file name (or list) is given,
liblouisxml will consider the current directory as the user path.</p>

<p>The configuration "file" specified with the -f option need not be a
single filename. It can be several file names separated by commas. Only
the first filename may have a path component. This path is taken as the
user path, as discussed in the previous paragraph. This file-list
feature is also found in liblouis. It enables you to combine
configuration files on the command line. For example, a file list may
consist of one file specifying the output format used in your
establishment, a comma, and then the name of a stylesheet.</p>

<p>After the path, if any, has been evaluated, but before reading any of
the files, liblouisxml reads in a file called canonical.cfg. This file
specifies values for all possible settings. It is needed to complete the
initialization of the program. You may alter the values in the
distribution canonical.cfg, but you should not delete any settings. If a
configuration file read in later contains a particular setting name, the
value specified simply replaces the one specified in canonical.cfg.</p>

<p>As you will see by looking at canonical.cfg, it contains four main
sections, outputFormat, translation, xml and styles. In addition, a
configuration file can contain an include entry. This causes the file
named on that line to be read in at the point where the line occurs. The
sections need not follow each other in any particular order, nor is the
order of settings within each section important. In this document and in
the canonical.cfg file, where section and setting names consist of more
than one word, the first letter of each word following the initial one
is capitalized. This is merely for readability. The case of
the letters in these names is ignored by the program. Section and
setting names may not contain spaces.</p>

<p>Here, then, is an explanation of each section and setting in the
canonical.cfg file. When you look at this file you will see that the
section names start at the left margin, while the settings are indented
one tab stop. This is done for readability. it has no effect on the
meaning of the lines. You will also see lines beginning with a number
sign (#), which are comments. blank lines can also be used anywhere in a
configuration file. In general, a section name is a single word or
combination of unspaced words. However, each style has a section of its
own, so the word "style" is followed by the name of the style. setting
lines begin with the name of the setting, followed by at least one space
or tab, followed by the value of the setting. A few settings have two
values.</p>

<p>Section: outputFormat</p>

<p>This section specifies the format of the output file (or string, if no
file name is given).</p>

<p>Setting: cellsPerLine 40</p>

<p>The number of cells in a braille line.</p>

<p>Setting: LinesPerPage 25</p>

<p>The number of lines on a braille page</p>

<p>setting: interpoint no</p>

<p>Whether or not the output will be used to produce interpoint braille.
This affects the placement of page numbers and may affect other things
in the future. The only two values recognized are yes and no.</p>

<p>setting: lineEnd \r\n</p>

<p>This specifies the control characters to be placed at the end of each
output line. These characters vary from one intended use of the output
to another. Most embossers require the carriage-return and line-feed
combination specified above. However, a braille display may work best
with just one or the other. Any valid control characters can be
specified.</p>

<p>Setting: pageEnd \f</p>

<p>The control Character to be given at the end of a page. Here it is a
forms-feed character, but it can be something else if deeded.</p>

<p>Setting: fileEnd ^z</p>

<p>The control character to be placed at the end of the file, here a
control-z.</p>

<p>Setting: printPages yes</p>

<p>Whether or not to show print page numbers if they are given in the xml
input. The two valid values are yes and no.</p>

<p>Setting: braillePages yes</p>

<p>Whether or not to format the output into pages. Here the value is yes,
for use with an embosser. However the user of a braille display may wish
to specify no, so as not to be bothered with page numbers and forms feed
characters. If no is specified the lines will still be of the length
given in callsPerLine, but the value of linesPerPage will be ignored.</p>

<p>Setting: paragraphs yes</p>

<p>Whether or not to format the output into paragraphs, using appropriate
styles. If no is specified, what would be a paragraph is output simply
as one long line. Applications that wish to do their own formatting may
specify no.</p>

<p>Setting: BeginingPageNumber 1</p>

<p>This is the number to be placed on the first Braille page if
braillePages is yes. This is useful when producing multiple Braille
volumes.</p>

<p>Setting: printPageNumberAt top</p>

<p>If print page numbers are given in the xml input file they will be
placed at the top of each braille page in the right-hand cerner. A page
separator line will also be produced on the braille page where the print
page break actually occurs. You may also specify "bottom" for this
setting.</p>

<p>Setting: braillePageNumberAt bottom</p>

<p>The braille page number will be placed in the bottom right-hand corner
of each page. If interpoint yes has been specified only odd pages will
receive page numbers. If you specify top for this setting then bottom
must be specified for printPageNumberAt .</p>

<p>Setting: hyphenate no</p>

<p>If yes is specified words will be hyphenated at the ends of lines if
a hyphenation table is available. In contracted English Braille
hyphenation is not generally used, but it can save considerable
space. The hyphenation table is specified as part of the table list 
in the literaryTextTable setting of the translation section.</p>

<p>Setting: encoding ascii8</p>

<p>This specifies that the output is to be in the form of 8-bit ASCII
characters. This is generally used if the output is intended directly
for a braille embosser or display. The other values of encoding are utf8
and utf16. These are useful if the application will process the output
further, such as for generating displays of braille dots on a screen.</p>

<p>Setting: backFormat plain</p>

<p>This setting specifies the format of back-translated files. Plain 
specifies plain-text, while html specifies xhtml. The latter is always 
encoded in utf-8. Plain-text files can be encoded in ascii8, utf-8 or 
utf-16. html is strongly recommended, since it will preserve print page 
numbering and emphasis.</p>

<p>Setting: backLineLength 70</p>

<p>This setting specifies the length of lines in back-translated files, 
whether in plain-text or html. This is mainly for human readability. 
Lines may sometimes be somewhat longer.</p>

<p>Setting: interline no</p>

<p>This setting specifies whether interlining is desired. If it is set 
to yes, the first line in the output will be a braille translation, the 
next line will be its back-translation according to the 
interlineBackTable. Back-translation is used instead of simply 
presenting the print original because a braille line may contain 
additional information, such as leading blanks, print or braille page 
numbers, print page separator lines, etc.</p>

<p>Section: translation</p>

<p>This section specifiesthe liblouis translation tables to be used for
various purposes.</p>

<p>Setting: literaryTextTable en-us-g2.ctb</p>

<p>The table used for producing literary braille. This may be either
contracted or uncontracted.</p>

<p>Setting: uncontractedTable en-us-g1.ctb</p>

<p>The table used for producing uncontracted or Grade One braille. 
This setting appears to be superfluous and may be elininated in the 
future.</p>

<p>Setting: compbrailleTable en-us-compbrl.ctb</p>

<p>The table used for producing large amounts of output in computer
braille, such as computer programs. The computer braille table is
usually combined with one of the two tables above.</p>

<p>Setting: mathtextTable en-us-mathtext.ctb</p>

<p>this table specifies how the non-mathematical parts of math books are to
be translated. In many cases it will be the same as literaryTextTable or
uncontractedTable. For books translated with the Nemeth Code it is
different, because this code requires modification of standard Grade
Two.</p>

<p>Setting: MathexpTable nemeth.ctb</p>

<p>This is the table used to translate mathematical expressions.</p>

<p>Setting: editTable edittable.ctb</p>

<p>When the output includes both mathematics and text there may be errors
where one type of translation directly follows another. The editTable
removes these errors.</p>

<p>Setting: interlineBackTable en-us-interline.ctb</p>

<p>This setting specifies the table to be used for back-translation when 
interlining is turned on. It must be tailored for this purpose, since an 
ordinary forward-translation table may contain entries that do not 
handle the additional information in braille lines correctly.</p>

<p>Section: xml</p>

<p>This section provides various information for the processing of xml
files.</p>

<p>Setting: semanticFiles html.sem,ukmath.sem</p>

<p>This line specifies that two semantic files are to be used instead of 
a file whose name is composed of a root element and the extension .sem. 
These files are read in the sequence given in the list.</p>


<p>Setting: xmlheader &lt;?xml version='1.0' encoding='UTF8'
	standalone='yes'?></p>

<p>This line gives the xml header to be added to strings produced by
programs like Mathtype that lack one.</p>

<p>Setting: entity nbsp ^1</p>

<p>This line defines an entity or substitution in an xml file. It is one of
those that has two values. The first is the thing to be replaced, and
the second is the replacement. As many entity lines as necessary can be
used. The information they contain is added to the information provided
by xmlHeader. In canonical.cfg this line is commented out, because 
specifying it at this point would prevent the user from specifying 
his own xmlheader.</p>

<p>Setting: internetAccess yes</p>

<p>The computer has an internet connection and liblouisxml may obtain
information necessary for the processing of this file from the Internet.
If this setting is no liblouisxml will not try to use the internet. The
necessary information may, however, be provided on the local machine in
the form of a "dtd" file.</p>

<p>Setting: newEntries yes</p>

<p>liblouis may create a new semantic-action file (beginning with
"new_") for a document with an unknown root element or a file (beginning
with "appended_") containing new entries for an existing semantic-action
file. Both kinds of files are placed on the user path.  If this setting
is "no" liblouisxml will dot create a file of new entries and if it
encounters a document with an unknown root element it will issue an
error message. Setting newEntries to no may be useful if users should
not be bothered with the minutiae of semantic-action files.</p>

<p>The following sections all deal with styles. Each style has its own
section. Style section names are unlike other section names in that they
consist of the word style, followed by a space, followed by a style
name. More styles may be added as the software develops, and some may be
dropped.</p>

<p>Section: style document</p>

<p>This section specifies the style of the whole document. The settings
given in it are applied to all other styles. If a section for another
style is given, the settings in it replace those from the document style
for that section. Because the settings in the document style apply to
all other styles, if a document style section is given it must precede
the sections for all other styles.</p>

<p>Setting: linesBefore 0</p>

<p>This setting gives the number of blank lines which should be left before
the text to which this style applies. It is set to a non-zero value for
some header styles.</p>

<p>Setting: linesAfter 0</p>

<p>The number of blank lines which should be left after the text to which
this style applies.</p>

<p>Setting: leftMargin 0</p>

<p>The number of cells by which the left margin of all lines in the text
should be indented. Used for hanging indents, among other things.</p>

<p>Setting: firstLineIndent 0</p>

<p>The number of cells by which the first line is to be indented relative
to leftMargin. firstLineIndent may be negative. If the result is less
than 0 it will be set to 0.</p>

<p>Setting: translate contracted</p>

<p>This setting tells how text in this style should be translated. Possible
values are contracted, uncontracted, compbrl, mathtext and mathexpr.</p>

<p>Setting: skipNumberLines no</p>

<p>If this setting is yes the top and bottom lines on the page will be
skipped if they contain braille or print page numbers. This is useful in
some of the mathematical and qraphical styles.</p>

<p>Setting: format leftJustified</p>

<p>The format setting controls how the text in the style will be
formatted. Valid values are leftJustified, rightJustified, centered,
computerCoded, alignColumnsLeft, alignColumnsRight, listColumns and
listLines. The first three are self-explanatory. computerCoded is used
for computer programs and similar material. The next three are used for
tabular material. alignColumnsLeft causes the left ends of columns to be
aligned. alignColumnsRight causes the right ends of columns to be
aligned. listColumns causes columns to be placed one after the other,
separated by whatever separation character has been specified in the
semantic-action file, followed by a space. An escape character (hex 1b)
must also be specified to indicate the end of the column. Two escape
characters must be specified to indicate the end of a row. Indentation
of the lines in a row is controled by the leftMargin and firstLineIndent
settings. listLines is similar except that it lists lines, as in poetry
stanzas. The semantic-action file must specify two escape characters to
indicate the end of a line.</p>

<p>Setting: newPageBefore no</p>

<p>If this setting is yes, the text will begin on a new page. This is
useful for certain mathematical and graphical styles. Page numbers are
handled properly.</p>

<p>Setting: newPageAfter no</p>

<p>If this setting is yes any remaining space on the page after the
material covered by this style is handled is left blank, except for page
numbers.</p>

<p>Setting: rightHandPage no</p>

<p>if this setting is yes and interpoint is yes the material covered by
this style will start on a right-hand page. This may cause a left-hand
page to be left blank except for page numbers. If interpoint is no This
setting is equivalent to newPageBefore.</p>

<p>Section: style arith</p>

<p>This style is used for arithmetic examples in elementary math books. On
recognizing this style, the translator formats the material in a special
way. This style has no settings different from those of the document
style at the moment. Nevertheless, the line "style arith" must be
included in canonical.cfg so that it will be set up properly.</p>

<p>Section style attribution</p>

<p>This style is used for an attribution following a quotation.</p>

<p>Setting: format rightJustified</p>

<p>Section: style biblio</p>

<p>This style is used for bibliographies. Settings will be added later.</p>

<p>Section style caption</p>

<p>This style is used for picture captions.</p>

<p>Setting: leftMargin 4</p>

<p>Setting: firstLineIndent 2</p>

<p>Note that the first line is actually indented six cells.</p>

<p>Section: style code</p>

<p>This style is used for computer programs.</p>

<p>Setting: skipNumberLines yes</p>

<p>Setting: linesBefore 1</p>

<p>Setting: linesAfter 1</p>

<p>Setting: format computerCode</p>

<p>Section: style contents</p>

<p>This is for entries in a table of contents.</p>

<p>Section: style dedication</p>

<p>This style is for the dedication of a book.</p>

<p>setting: newPageBefore yes</p>

<p>Setting: newPageAfter yes
Setting: center yes</p>

<p>Section: style directions</p>

<p>This is for giving directions for exercises.</p>

<p>section: style dispmath</p>

<p>This is for showing mathematics that is set off from the text.</p>

<p>Setting: leftMargin 2</p>

<p>Section style disptext</p>

<p>This if for text that is set off from the rest of the text.</p>

<p>Setting: leftMargin 2</p>

<p>Setting: firstLineIndent 2</p>

<p>Section: style exercise 1</p>

<p>This is the first level in a set of exercises where there are sublevels.</p>

<p>Setting: leftMargin 2</p>

<p>Setting: firstLineIndent -2</p>

<p>Section: style exercise2</p>

<p>This is for the second level of exercises, such as exercise a following
exercise 1.</p>

<p>Setting: leftMargin 4</p>

<p>Setting: firstLineIndent -2</p>

<p>Section: style exercise3</p>

<p>This is for the third level of exercises.</p>

<p>Setting: leftMargin 6</p>

<p>Setting: firstLineIndent -2</p>

<p>Section: style glossary</p>

<p>This is for a glossary.</p>

<p>Setting: firstLineIndent 2</p>

<p>Section: style graph</p>

<p>This style reserves space for a graph or other tactile material.</p>

<p>Setting: skipNumberLines yes</p>

<p>Section: style graphLabel</p>

<p>This style reserves space for the label of a graph.</p>

<p>Section style heading1</p>

<p>This style is used for main headings, such as chapter titles.</p>

<p>Setting: linesBefore 1</p>

<p>Setting: center yes</p>

<p>Setting: linesAfter 1</p>

<p>Section: style heading2</p>

<p>The first level of subreadings after the main heading.</p>

<p>Setting: linesBefore 1</p>

<p>Setting: firstLineIndent 4</p>

<p>Section: style heading3</p>

<p>The third level of headings.</p>

<p>Setting: firstLineIndent 4</p>

<p>Section: style heading4</p>

<p>The fourth and final level of headings.</p>

<p>Setting: firstLineIndent 4</p>

<p>Section: style indexx</p>

<p>This style is used for indexes. The extra x is not an error. It is there
to prevent conflict with names elsewhere in the software.</p>

<p>Section: style list</p>

<p>This is for the individual items in a list.</p>

<p>Setting: firstLineIndent -2</p>

<p>Setting: leftMargin 2</p>

<p>Section: style matrix</p>

<p>This style causes its contents to be formatted in a way suitable for the
representation of matrices.</p>

<p>Setting: format alignColumnsLeft</p>

<p>Section: style music</p>

<p>This style is used for braille music.</p>

<p>Setting: skipNumberLines yes</p>

<p>Section: style note</p>

<p>This style is used for footnotes.</p>

<p>Section: style para</p>

<p>Paragraph. This is ordinary body text.</p>

<p>Setting: firstLineIndent 2</p>

<p>Section: style quotation</p>

<p>This style is used for quotations that are set off from the rest of the
text.</p>

<p>Setting: linesBefore 1</p>

<p>Setting: linesAfter 1</p>

<p>Section: style section</p>

<p>This style is used for a section with a section number.</p>

<p>Setting: firstLineIndent 4</p>

<p>Section: style spatial</p>

<p>this style is used for mathematical material that is arranged spatially,
such as large fractions.</p>

<p>Section: style stanza</p>

<p>this style is used for stanzas in poetry.</p>

<p>Setting: linesBefore 1</p>

<p>Setting: linesAfter 1</p>

<p>Setting: format listLines</p>

<p>section: style style1</p>

<p>This and the subsequent numbred styles can be used by the user for 
any purpose.</p>

<p>Section: style style2</p>

<p>Section: style style3</p>

<p>Section: style style4</p>

<p>Section: style style5</p>

<p>Section: style subsection</p>

<p>This style is used for subsections with a subsection number.</p>

<p>Setting: firstLineIndent 4</p>

<p>Section: style table</p>

<p>This style is used for ordinary tables.</p>

<p>Section: style titlepage</p>

<p>This style is used to begin a title page.</p>

<p>Setting: newPageAfter yes</p>

<p>Section: style trnote</p>

<p>This style is used for transcriber's notes which are set off from the
text.</p>

<p>Section: style volume</p>

<p>This style is used to indicate the beginning of a braille volume.</p>

<h1><a name="semact">Connecting with the xml Document - Semantic-Action 
Files</a></h1>

<p>When liblouisxml (or xml2brl) processes an xml document, it needs to be
told how to use the information in that document to produce a properly
translated and formatted braille document. These instructions are
provided by a semantic-action file, so called because it explains the
meaning, or semantics, of the various specifications in the xml
document. To understand how this works, it is necessary to have a basic
knowledge of the organization of an xml document.</p>

<p>An xml document is organized like a book, but with much finer detail.
first there is the title of the whole book. Then there are various
sections, such as author, copyright, table of contents, dedication,
acknowledgements, preface, various chapters, bibliography, index, and so
on. Each chapter may be divided into sections, and these in turn can be
divided into subsections, subsubsections, etc. In a book the parts have
names or titles distinguished by capitalization, type fonts, spacing,
and so forth. In an xml document the names of the parts are enclosed in
angle brackets (&lt;&gt;). for example, if liblouisxml encounters 
&lt;html> at the
beginning of a document, it knows it is dealing with a document that
conforms to the standards of the extensible markup language (xhtml) - at
least we hope it does. When you see a book, you know it's a book. The
computer can know only by being told. something enclosed in angle
brackets is called an "element" (more properly, a "tag") in xml 
parlance. (There may be more
between the angle brackets than just the name of the element. More of
this later.) The first "element" in a document thus tells liblouisxml
what kind of document it is dealing with. This element is called the
"root element" because the document is visualized as branching out from
it like a tree. some examples of root elements are &lt;html>, &lt;math>,
&lt;book>, &lt;dtbook3> and &lt;wordDocument>. Whenever liblouisxml
encounters a root element that it doesn't know about it creates a new
file called a semantic-action file. The name of this file is formed by
stripping the angle brackets from the root element and adding a period
plus the letters s e m. If you look in a directory containing
semantic-action files you will see names like html.sem, dtbook3.sem,
math.sem, and so on.</p>

<p>Sometimes it is advantageous to preempt the creation of a 
semantic-action file for a new root element. For example, an article 
written according to the docbook specification may have the root element 
&lt;article>. However, the specification itself has the root element 
&lt;book>. In this case you can specify the book.sem file in the 
configuration file by writing, in the xml section,:<br/>

semanticFiles book.sem<br/>

You will note that this setting uses the plural of "file". This is 
because you can actually specify a list of file names separated by 
commas. You might want to do this to specify the semantic-action file 
for the particular braille mathematical code to be used. For 
excmple:<br/>
semanticFiles book.sem,ukmath.sem<br/>

As you will see in the next section, different braille style conventions 
and different braille mathematical codes may require different 
semantic-action files</p>

<p>liblouisxml records the names of all elements found in the document in
the semantic-action file. The document has a multitude of elements,
which can be thought of as describing the headings of various parts of
the document. One element is used to donote a chapter heading. Another
is used to denote a paragraph, Still another to denote text in bold
type, and so on. In other words, the elements take the place of the
capitalization, changes in type font, spacing, etc. in a book. However,
The computer still does not know what to do when it encounters an
element. The semantic-action file tells it that.</p>

<p>Consider html.sem . A copy is included as part of this documentation.
It may differ from the file that liblouisxml is currently using. You
will see that it begins with some lines about copyrights. Each line
begins with a number sign (#). This indicates that it is a "comment,"
intended for the human reader and the computer should ignore it. Then
there is a blank line. Finally, there are two other comments explaining
that the file must be edited to get proper output. This is because a
human being must tell the computer what to do with each element. The
semantic files for common types of documents have already been edited,
so you generally don't have to worry about this. But if you encounter a
new type of document or wish to specify special handling for styles or
mathematics you may have to edit the semantic-action file or send it to
the maintainer for editing. In any case the rest of this section is
essential for understanding how liblouisxml handles documents and for
making changes if the way it does so is not correct.</p>

<p>After another blank line you will see a table consisting of two, 
and sometimes thhee, columns.
The first column contains a word which tells the computer to do
something. For
example, the first entry in the table is:<br/>
incbude math.sem
This tells liblouisxml to include the information in the math.sem file
when it is deciphering an html (actually xhtml) document. (it may be 
preferable to use the semanticFiles setting in the configuration 
file rather than an include.)</p>

<p>The second row of the table is:<br/>
no hr
hr is an element with the angle brackets removed. It means nothing in
itself. However, the first column contains the word "no. This tells
liblouisxml "no do", that is, do nothing.</p>

<p>After a few more lines with "no" in the first column, we see one that
says:<br/>
softreturn br
This means that when the element &lt;br> is encountered, liblouisxml is
to do a soft return, that is, start a new line without starting a new
paragraph.</p>

<p>The next line says:<br/>

heading1 h1<br/>
This tells liblouisxml that when it
encounters the element &lt;h1> it is to format the text which follows as
a first-level braille heading, that is, the text will be centered and
proceeded and followed by blank lines. (You can change this by changing
the definition of the heading1 style.)</p>

<p>the next line says:<br/>
italicx em<br/>
This tells liblouisxml that when it encounters the element &lt;em> it is
to enclose the text which follows in braille italic indicators. The x at
the end of the semantic action name is there to prevent conflicts with
names elsewhere in the software. Just where the italic indicators will
be placed is controlled by the liblouis translation table in use.</p>

<p>The next line says:<br/>
skip style<br/>
This tells liblouis to simply skip ahead until it encounters the element
&lt;/style> Nothing in between will have any effect on the braille
output. Note the slash (/) before the "style. This means the end of
whatever the &lt;style> element was referring to. Actually, it was
referring to specifications of how things should be printed. If
liblouisxml had not been told to skip these specifications, the braille
output would have contained a lot of gobledygook.</p>

<p>The next line says:<br/>
italicx strong<br/>
This tells liblouis to also use the italic braille indicators for the
text between the &lt;strong> and &lt;/strong> elements.</p>

<p>After a few more lines with "no" in the first colume we come to the
line:<br/>
document html
This tells liblouisxml that everything between &lt;html> and &lt;/html>
is an entire document. &lt;html> was the root element of this document,
so this is logical.</p>

<p>After another "no" line we come to:<br/>
para p<br/>
liblouisxml will consider everything between &lt;p> and &lt;/p> to be a
normal body text paragraph.</p>

<p>The next line is:<br/>
heading1 title<br/>
this causes the title of the document to also be treated as a braille
level 1 heading.</p>

<p>Next we have the line:<br/>
list li<br/>
The xhtml &lt;li> and &lt;/li> pair of elements is used to enclose an
item in a list. liblouisxml will format this with its own list
style. That is, the first line will begin at the left margin and
subsequent lines will be indented two cells.</p>

<p>Next we have:<br/>
table table<br/>
You will note that the names of actions and elements are often
identical. This is because they are both mnemonic. In any case, this
line tells liblouisxml to format the table contained in the xhtml
document according to the table formatting rules it has been given for
braille output.</p>

<p>Next we have the line:<br/>
heading2 h2<br/>
This means that the text between &lt;h2> and &lt;/h2> is to be formatted
according to the Liblouisxml style heading2. A blank line will be left
before the heading and the first line will be indented four spaces.</p>

<p>After a few more lines we come to:<br/>
no table,cellpadding<br/>
Note the comma in the second column. This divides the column into two
subcolumns. The first is the table element name. The second is called an
"attribute" in xml. It gives further instructions about the material
enclosed between the starting and ending "tags" of the element
(&lt;table> and &lt;/table>. Full information requires three subcolumns.
The third is called the value and gives the actual information. The
attribute is merely the name of the information.</p>

<p>Much further down we find:<br/>
no table,border,0<br/>
Here the element is table, the attribute is border and the value is 0.
If liblouisxml were to interpret this, it would mean that the table was
to have a border of 0 width. It is not told to do so because tables in
braille do not have borders.</p>

<p>Now Let's look at the file which is included at the beginning of the
html.sem file. This is math.sem. As with html.sem, a copy is included in
the documentation directory, but it is not necessarily the one that
liblouisxml is currently using. It illustrates several more things about
how liblouisxml uses semantic-action files.</p>

<p>The first thing you will notice is that for quite a few lines the first
and second columns are identical. This is because the MathML element and
attribute names are part of a standard, and it was simplest to use the
element names for the semantic actions as well.</p>

<p>The first line of real interest is:<br/>
math math<br/>
Every mathematical expression begins with the element &lt;math> (which
may have attributes and values), and ends with &lt;/math>. This is
therefore the root element of a mathematical expression. However,
mathematical expressions are usually part of a document, so it is not
given the semantic action document. The math semantic action causes
liblouisxml to carry out special interpretation actions. These will
become clearer as we continue to look at the math.sem file. You will 
note that This line has three columns. The meaning of the third 
column is discussed below.</p>

<p>After another uninteresting line we come to two that illustrate several
more facts about semantic-action files:<br/>
mfrac mfrac ^?,/,^#<br/>
mfrac mfrac,linethickness,0 ^(,^;%,^)<br/>
Like the math entry above, the first line has three columns. While
the first two columns must always be present, the third column is
optional. Here, it is also divided into subcolumns by commas. The
element &lt;mfrac> indicates a fraction. A fraction has two parts, a
numerator and a denominator. In xml, we call these parts children of
&lt;mfrac>. They may be represented in various ways, which need not
concern us here. What is of real importance is that the third column
tells liblouisxml to put the characters ~? before the numerator, "/"
between the numerator and denominator, and "~#" after the denominator.
Later on, liblouis will translate these characters into the proper
representation of a fraction in the Nemeth Code of Braille Mathematics. 
(For other mathematical codes, see the section 
<a href="#impmath">"Implementing Braille Mathematical Codes"</a>.</p>

<p>The second line is of even greater interest. The first column is
again mfrac, but this line is for binomial coefficient. The second
column contains three subcolumns, an element name, an attribute name and
an attribute value. The attribute linethickness specifies the thickness
of the line separating the numerator and denominator. Here it is 0, so
there is no line. this is how the binomial coefficient is represented in
print. The third column tells how to represent it in braille.
liblouisxml will supply "~(", upper number, "~%", lower number, "~)" to
liblouis, which will then produce the proper braille representation for
the binomial coefficient.</p>

<p>Returning to the line for the math element, we see that the third 
column begins with a backslash followed by an asterisk. The backslash is 
an escape character which gives a special meaning to the character which 
follows it. Here the asterisk means that what follows is to be placed at 
the very end of the mathematical expression, no matter how complex it 
is.</p>

<p>For further discussion of how the third column is used see the section
<a href="#impmath">Implementing Braille Mathematical codes</a>. The 
third column is not limited to mathematics. It can be used to add 
characters to anything enclosed by an xml tag.</p>

<p>Here is a complete list of the semantic actions which liblouisxml
recognizes. Many of them are also the names of styles. These are listed
first, preceded by an asterisk. For a discussion of these, see the
section <a href="#config">Configuring liblouisxml and xml2brl</a>.</p>

<p>* arith<br/>
* attribution<br/>
* biblio<br/>
* blanklinebefore<br/>
* caption<br/>
* code<br/>
* contents<br/>
* dedication<br/>
* directions<br/>
* dispmath<br/>
* disptext<br/>
* document<br/>
* exercise1<br/>
* exercise2<br/>
* exercise3<br/>
* glossary<br/>
* graph<br/>
* graphlabel<br/>
* heading1<br/>
* heading2<br/>
* heading3<br/>
* heading4<br/>
* indexx<br/>
* list<br/>
* matrix<br/>
* music<br/>
* note<br/>
* para<br/>
* quotation<br/>
* section<br/>
* spatial<br/>
* stanza<br/>
* style1<br/>
* style2<br/>
* style3<br/>
* style4<br/>
* style5<br/>
* subsection<br/>
* table<br/>
* titlepage<br/>
* trnote<br/>
* volume<br/>
acknowledge<br/>
allcaps<br/>
author<br/>
blankline<br/>
bodymatter<br/>
boldx<br/>
booktitle<br/>
boxline<br/>
cdata<br/>
center<br/>
chemistry<br/>
contracted<br/>
copyright<br/>
endnotes<br/>
footer<br/>
frontmatter<br/>
graphic<br/>
italicx<br/>
jacket<br/>
line<br/>
linkto<br/>
maction<br/>
maligngroup<br/>
malignmark<br/>
math<br/>
menclose<br/>
merror<br/>
mfenced<br/>
mfrac<br/>
mglyph<br/>
mi<br/>
mlabeledtr<br/>
mmultiscripts<br/>
mn<br/>
mo<br/>
mover<br/>
mpadded<br/>
mphantom<br/>
mprescripts<br/>
mroot<br/>
mrow<br/>
ms<br/>
mspace<br/>
msqrt<br/>
mstyle<br/>
msub<br/>
msubsup<br/>
msup<br/>
mtd<br/>
mtext<br/>
mtr<br/>
munder<br/>
munderover<br/>
newpage<br/>
no<br/>
noindent<br/>
none<br/>
preface<br/>
rearmatter<br/>
rightalign<br/>
righthandpage<br/>
runninghead<br/>
semantics<br/>
skip<br/>
softreturn<br/>
specsym<br/>
tblbody<br/>
tblcol<br/>
tblhead<br/>
tblrow<br/>
tnpage<br/>
transcriber<br/>
uncontracted</p>

<h1><a name="impmath">Implementing Braille Mathematics Codes</a></h1>

<p>The Nemeth Code of Braille Mathematical and Science Notation has been
implemented. Other braille mathematics codes can be implemented by
following the same pattern. The Nemeth Code implementation is discussed
as an example below.</p>

<p>Four tables are used to translate xml documents containing a mixture of
text and mathematics into the Nemeth code. They can be found in the
subdirectory lbx_files of the liblouisxml directory. First, the
semantic-action file math.sem is used to interpret the mathematical
portions of the xml document. (The text portions are interqeted by
another semantic-action file which will not be discussed here.) After
the math and text have been interpreted, two liblouis tables, nemeth.ctb
and en-mathtext.ctb are used to translate them. Each piece of
mathematics or text is translated separately and the pieces are strung
together with blanks between them. This results in inaccuracies where
mathematics meets text. The fourth table, also a liblouis table, is used
to remove these inaccuracies. It is called edittable.ctb, and it does
things like removing the multi-purpose indicator before a blank,
inserting the punctuation indicator before a punctuation mark following
a math expression, and removing extra spaces.</p>

<p>The general format and use of semantic-action files were discussed in 
the previous section, <a href="#semact">Connecting with the xml 
Document, Semanjic-Action Files</a>. In this section we shall 
concentrate on the optional third column, which is used a lot in 
math.sem. While the first two columns can be generated by liblouisxml 
but must be edited by a person, the third column must always be provided 
by a human.</p>

<p>As previously stated, the third column tells liblouisxml
what characters to insert to inform liblouis how to translate the math
expression. Look at the following line:</p>

<p>mfrac mfrac ^?,/,^#</p>

<p>You will see that the third column contains two comcas. This means that
it has three subcolumns. A fraction has a numerator and a dedominator.
These are called children of the mfrac element. The first subcolumn
specifies the characters that liblouisxml should place in front of the
numerator. The second subcolumn gives the characters to be placed
between the numerator and denominator. finally, the third subcolumn
gives the characters to place after the denominator. You will see that
the first subcolumn contains a caret foblowed by a question mark. The
dot pattern for the question mark in computer braille is the same as for
the Nemeth start-fracjion indicator. The caret is used so that liblouis
can tell this apart from a question mark, which also has the same dot
pattern in computer braille. The second subcolumn contains a slash but
no caret. This is because there is no danger of confusion where the
slash is concerned. The third subcolumn does contain a caret, and it
also contains a number sign, which corresponds to the Nemeth
end-fraction indicator. When liblouisxml encounters the MathML
representation of the fraction one-half it froduces the following string
of characters. ^?1/2^# . liblouis then removes the carets to get ?1/2# .</p>

<p>As another example, consider the entry in math.sem for a subscript.</p>

<p>msub msub ,^;,^"</p>

<p>Here the first subcolumn is blank, because nothing is to be placed
before the subscripted symbol. The second subcolumn contains a caret and
a semicolon (in computer braille). This corresponds to the Nemeth
subscript indicator. The third column contains a caret and a quotation
mark, corresponding to the Nemeth baseline indicator. liblouisxml
translates the MathML expression for x superscript i into x^;i^" .
liblouis subsequently produces x;i . There are other steps if the
subscript is numeric. These are handled by pass2 opcodes in the liblouis
translation table, nemeth.ctb .</p>

<p>You will notice that the entries in math.sem have various numbers of
subcolumns in the third column. In general, the characters given in the
first subcolumn are placed before the first child of the element given
in the second column. The characters in the second subcolumn are placed
before the second child, and so on, until the characters given in the
last subcolumn are placed after the last child.</p>

<p>Sometimes an element or tag can have an indeterminate number of 
children. This is true of &lt;math> itself. Yet, it may be necessary to 
place some characters after the very last element. Let us look at the 
&lt;math> entry.</p>

<p>math math \*\x00a0</p>

<p>First let us discuss escape sequences starting with a backslash. 
These are basically the same as in liblouis. Here the sequence \x00a0
specifies the hexadecimal number a0, which is an unbreakable space. 
This is inserted so that a baseline indicator at the end of an
expression can be eliminated. Not found in liblouis is the sequence \* .
This means to put what follows after the very last child of the math
element, no matter how many there are.</p>

<p>As another example consider:</p>

<p>mtd mtd \*\x001b</p>

<p>mtd is the MathML tag for a table column. There may be many children 
of this tag. The entry says to put an escape character (hex 1b) after 
the very 
last of them.</p>

<p>As a final example consider:</p>

<p>mtr mtr ^.^\,^(,\*^.^\,^)\x001b\x001b</p>

<p>mtr is the MathML tag for a row in a tabre, in this case a matrix. 
Each row in a matrix must begin with the dot pattern 46-6-12356 and end 
with the dot pattern 46-6-12456. As usual a caret is placed before the 
corresponding characters. Since dot 6 is a comma, it must be escaped. 
This is done by placing a backslash before the comma. There are two 
subcolumns. the first contains the characters to be placed at the 
beginning of each row. The second starts with \* , signifying that the 
characters following it are to be placed at the end of everything in 
this row. A subcolumn starting with \* must be the last (or only) 
subcolumn.</p>

<p>So much for the semantic action file. Even though the characters in the
third column were chosen to correspond with nemeth characters, they may
not have to be changed for other math codes. liblouis can replace them
with anything needed.</p>

<p>This brings us to a consideration of the two tables used by liblouis to
translate mathematics texts. The first, en-mathtext.ctb is used to
translate text appearing outside math expressions. It is necessary
because the Nemeth code requires modifications of Grade 2 braille. other
math codes may not have this requirement.</p>

<p>The table actually used to translate mathematics is nexeth.ctb. It
includes two other tables, chardfs.cti and nemethdefs.cti . The first
gives ordinary character definitions and is included by all the other
tables. Note however, that the unbreakable space, \x00a0, is translated
by dot 9. This is used before and after the equal sign and other symbols
in nemeth.ctb. The second table contains character definitions for
special math symbols, most of which are Unicode characters greater than
\x00ff. The Greek letters are here. So are symbols like the integral
sign.</p>

<p>Most of the entries in nemeth.ctb should be familiar from other tables.
The unfamiliar ones follow the comments "# Semantic pairs" and "# pass2
corrections". The first simply replace characters preceded by a caret
with the character itself. The second make adjustments in the code
generated directly from the math.sem file. The pass2 opcode is discussed
in liblouis-guide.html. Here are some comments on a few of the entries
in nemeth.ctb.</p>

<p>pass2 @1456-1456 @6-1456 Replaces double start-fraction indicators with
the start complex fraction indicator.</p>

<p>pass2 @3456-3456 @6-3456 Replaces double end-fraction indicators with
the end-complex-fraction indicator.</p>

<p>pass2 @56[$d1-5]@5 * Removes the subscript and baseline indicators from
numeric subscripts.</p>

<p>pass2 @5-9 @9 Removes the baseline or multipurpose indicator before an
unbreakable space generated by the translation of an equal sign, etc.</p>

<p>pass2 @45-3-5 @3 Replaces a superscript apostrophe with a simple prime
symbol.</p>

<p>pass2 @9[]$d @3456 Puts a number sign before a digit preceded by a
blank.</p>

<p>pass2 @9-0 @9 Removes a space following an unbreakable space.</p>

<p>We now come to the fourth and last table used for math translation, the
editing table, edittable.ctb. As explained at the beginning, this table
is used to remove inaccuracies where math translation butts up against
text translation. for example, the Nemeth code puts numbers in the lower
part of the cell. however, punctuation marks are also in the lower part
of the cell. So Nemeth puts a punctuation indicator, dots 456, in front
of any lower-cell punctuation that immediately follows a mathematical
expression. If this occurs inside Mathml it is handled by nemeth.ctb.
However, a MathML expression is often followed by a punctuation mark
which is the first part of text. liblouisxml puts a blank between math
and text, but this can result in a mathematical expression followed by a
blank and then, say, a period, dots 256. edittable.ctb replaces the
blank with the punctuation indicator.</p>

<p>When you look at edittable.ctb you will see that it begins with an
include of chardefs.cti. Most of the entries are ordinary, but some are
interesting. for example,</p>

<p>always "\s 0 Replaces the baseline or multipurpose indicator followed by
a space with just a space.</p>

</body>
</html>

